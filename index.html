<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LernLese-App</title>
    <style>
        :root {
            --primary-bg: #f8fbff;
            --accent-color: #4caf50;
            --syllable-1: #e53935; /* Rot */
            --syllable-2: #1e88e5; /* Blau */
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--primary-bg);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { color: #333; margin-bottom: 10px; }
        p { color: #666; margin-bottom: 20px; }

        /* Alphabet-Grid */
        .letter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(45px, 1fr));
            gap: 8px;
            width: 100%;
            max-width: 600px;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .letter-btn {
            aspect-ratio: 1;
            font-size: 1.2rem;
            font-weight: bold;
            border: 2px solid #eee;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            transition: all 0.2s;
        }

        .letter-btn.active {
            background-color: var(--accent-color);
            color: white;
            border-color: #388e3c;
            transform: translateY(-2px);
        }

        /* Wortanzeige */
        .word-display {
            font-size: clamp(3rem, 10vw, 5rem);
            font-weight: 800;
            margin: 50px 0;
            min-height: 1.2em;
            letter-spacing: 2px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .s-red { color: var(--syllable-1); }
        .s-blue { color: var(--syllable-2); }

        /* Navigation */
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .main-btn {
            padding: 15px 40px;
            font-size: 1.3rem;
            border-radius: 50px;
            border: none;
            background: #ff9800;
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
            transition: transform 0.2s;
        }

        .main-btn:active { transform: scale(0.95); }
        .main-btn:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; }

        .stats { font-size: 0.9rem; color: #888; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>Lese-Profi</h1>
    <p>Welche Buchstaben kannst du schon?</p>
    
    <div id="alphabet" class="letter-grid"></div>

    <div class="word-display" id="wordContainer">
        <span style="color: #ccc; font-size: 1.5rem;">Wähle Buchstaben aus...</span>
    </div>

    <div class="controls">
        <button id="nextBtn" class="main-btn" onclick="renderNextWord()" disabled>Nächstes Wort</button>
    </div>

    <div class="stats" id="statsInfo">0 Wörter verfügbar</div>

    <script>
    let dictionary = [];       // Alle Wörter aus der Datei
    let learnedLetters = new Set(); // Die vom User gewählten Buchstaben (kleingeschrieben)
    let filteredWords = [];    // Wörter, die nur bekannte Buchstaben enthalten

    // 1. Wörter aus der externen Datei laden
    async function initApp() {
        try {
            const response = await fetch('wortliste.txt');
            if (!response.ok) throw new Error();
            const text = await response.text();
            // Liste säubern: Zeilenumbrüche entfernen, leere Zeilen löschen
            dictionary = text.split('\n')
                             .map(w => w.trim())
                             .filter(w => w.length > 1);
        } catch (err) {
            console.warn("Nutze Fallback-Liste...");
            dictionary = ["Mama", "Papa", "Oma", "Opa", "Lama", "Nase", "Sofa", "Uhu", "Ameise"];
        }
        createAlphabet();
    }

    // 2. Alphabet-Buttons erstellen
    function createAlphabet() {
        const container = document.getElementById('alphabet');
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÜẞ".split("");
        
        chars.forEach(char => {
            const btn = document.createElement('button');
            btn.className = 'letter-btn';
            btn.innerText = char;
            btn.onclick = () => {
                btn.classList.toggle('active');
                const lowerChar = char.toLowerCase();
                
                // Buchstabe hinzufügen oder entfernen
                if(learnedLetters.has(lowerChar)) learnedLetters.delete(lowerChar);
                else learnedLetters.add(lowerChar);
                
                // Nach jeder Änderung den Pool der erlaubten Wörter neu berechnen
                updatePossibleWords();
            };
            container.appendChild(btn);
        });
    }

    // 3. Strikte Filter-Logik
    function updatePossibleWords() {
        if (learnedLetters.size === 0) {
            filteredWords = [];
        } else {
            filteredWords = dictionary.filter(word => {
                // Wort in Buchstaben zerlegen und gegen bekannte Buchstaben prüfen
                const wordChars = word.toLowerCase().split("");
                // Wichtig: Nur Wörter zulassen, bei denen JEDER Buchstabe bekannt ist
                return wordChars.every(c => learnedLetters.has(c));
            });
        }

        document.getElementById('statsInfo').innerText = `${filteredWords.length} Wörter gefunden`;
        document.getElementById('nextBtn').disabled = filteredWords.length === 0;
        
        // Sofort ein neues Wort anzeigen, wenn welche gefunden wurden
        if (filteredWords.length > 0) renderRandomWord();
        else document.getElementById('wordContainer').innerHTML = "---";
    }

    // 4. Zufälliges Wort auswählen und Silben färben
    function renderRandomWord() {
        if (filteredWords.length === 0) return;

        const container = document.getElementById('wordContainer');
        // Zufalls-Index berechnen
        const randomIndex = Math.floor(Math.random() * filteredWords.length);
        const word = filteredWords[randomIndex];

        // Silbentrennung nach Vokalgruppen (einfache deutsche Regel)
        const syllableRegex = /[^aeiouäöü]*[aeiouäöü]+(?:[^aeiouäöü](?![aeiouäöü]))*/gi;
        const syllables = word.match(syllableRegex) || [word];

        container.innerHTML = "";
        syllables.forEach((s, i) => {
            const span = document.createElement('span');
            span.innerText = s;
            span.className = (i % 2 === 0) ? 's-red' : 's-blue';
            container.appendChild(span);
        });
    }

    // Start der App
    initApp();
</script>
</body>
</html>